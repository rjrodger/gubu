!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Gubu=e()}}((function(){var e={},t={};Object.defineProperty(t,"__esModule",{value:!0}),t.Gubu=void 0;const n=Symbol.for("gubu$"),r={gubu$:n,v$:"0.2.1"};class o{constructor(e,t,n,r){this.match=!1,this.dI=0,this.nI=2,this.cI=-1,this.pI=0,this.sI=-1,this.valType="never",this.isRoot=!1,this.key="",this.type="never",this.stop=!0,this.nextSibling=!0,this.fromDefault=!1,this.ignoreVal=!1,this.err=[],this.parents=[],this.keys=[],this.path=[],this.root=e,this.vals=[e,-1],this.node=t,this.nodes=[t,-1],this.ctx=n||{},this.match=!!r}next(){this.stop=!1,this.fromDefault=!1,this.ignoreVal=!1,this.isRoot=0===this.pI;let e=this.nodes[this.pI];for(;+e;)this.pI=+e,e=this.nodes[this.pI],this.dI--;e?(this.node=e,this.updateVal(this.vals[this.pI]),this.key=this.keys[this.pI],this.cI=this.pI,this.sI=this.pI+1,this.parent=this.parents[this.pI],this.nextSibling=!0,this.type=this.node.t,this.path[this.dI]=this.key,this.oval=this.val):this.stop=!0}updateVal(e){this.val=e,this.valType=typeof this.val,"number"===this.valType&&isNaN(this.val)&&(this.valType="nan"),this.isRoot&&!this.match&&(this.root=this.val)}}class l extends TypeError{constructor(e,t,n){super(t.map(e=>e.t).join("\n")),this.gubu=!0,this.name="GubuError",this.code=e,this.desc=()=>({name:"GubuError",code:e,err:t,ctx:n})}toJSON(){return{...this,err:this.desc().err,name:this.name,message:this.message}}}const i={String:!0,Number:!0,Boolean:!0,Object:!0,Array:!0,Function:!0,Symbol:!0,BigInt:!0},u={string:"",number:0,boolean:!1,object:{},array:[],symbol:Symbol(""),bigint:BigInt(0),null:null};function s(e,t){var o,l,s,a,f;if(null!=e&&(null===(o=e.$)||void 0===o?void 0:o.gubu$)){if(n===e.$.gubu$)return e.d=null==t?e.d:t,e;if(!0===e.$.gubu$){let r={...e};return r.$={v$:"0.2.1",...r.$,gubu$:n},r.v=null!=r.v&&"object"==typeof r.v?{...r.v}:r.v,r.t=r.t||typeof r.v,"function"===r.t&&i[r.v.name]&&(r.t=r.v.name.toLowerCase(),r.v=L(u[r.t])),r.r=!!r.r,r.o=!!r.o,r.d=null==t?null==r.d?-1:r.d:t,r.b=r.b||[],r.a=r.a||[],r.u=r.u||{},r}}let p=null===e?"null":typeof e,c=e,d=!1,h=void 0,v={};if("object"===(p="undefined"===p?"any":p))Array.isArray(e)?p="array":null!=c&&Function!==c.constructor&&Object!==c.constructor&&null!=c.constructor&&(p="instance",v.n=c.constructor.name,v.i=c.constructor);else if("function"===p)if(i[e.name])p=e.name.toLowerCase(),d=!0,c=L(u[p]);else if(e.gubu===r||!0===(null===(l=e.$)||void 0===l?void 0:l.gubu)){let t=e.spec?e.spec():e;p=t.t,c=t.v,d=t.r,v=t.u}else void 0===e.prototype&&Function===e.constructor||Function===(null===(s=e.prototype)||void 0===s?void 0:s.constructor)?(p="custom",h=c,c=void 0):(p="instance",d=!0,v.n=null===(f=null===(a=c.prototype)||void 0===a?void 0:a.constructor)||void 0===f?void 0:f.name,v.i=c);else"number"===p&&isNaN(c)&&(p="nan");let y={$:r,t:p,v:null==c||"object"!==p&&"array"!==p?c:{...c},r:d,o:!1,d:null==t?-1:t,u:v,a:[],b:[]};return h&&y.b.push(h),y}function a(t,i){const u=null==i?{}:i;u.name=null==u.name?"G"+(""+Math.random()).substring(2,8):""+u.name;let a=s(t,0);function p(e,t,n){let r=new o(e,a,t,n);for(;r.next(),!r.stop;){let e=!1;if(0<r.node.b.length)for(let t=0;t<r.node.b.length;t++){let n=f(r.node.b[t],r);void 0!==n.done&&(e=n.done)}if(!e)if("never"===r.type)r.err.push(T("never",r,1070));else if("object"===r.type){let e;if(r.node.r&&void 0===r.val?r.err.push(T("required",r,1010)):void 0===r.val||null!==r.val&&"object"===r.valType&&!Array.isArray(r.val)?r.node.o&&null==r.val||(r.updateVal(r.val||(r.fromDefault=!0,{})),e=r.val):(r.err.push(T("type",r,1020)),e=Array.isArray(r.val)?r.val:{}),null!=(e=null==e&&!1===r.ctx.err?{}:e)){let t=Object.keys(r.node.v);if(0<t.length){r.pI=r.nI;for(let n of t){let t=r.node.v[n]=s(r.node.v[n],1+r.dI);r.nodes[r.nI]=t,r.vals[r.nI]=e[n],r.parents[r.nI]=e,r.keys[r.nI]=n,r.nI++}r.dI++,r.nodes[r.nI++]=r.sI,r.nextSibling=!1}}}else if("array"===r.type)if(r.node.r&&void 0===r.val)r.err.push(T("required",r,1030));else if(void 0===r.val||Array.isArray(r.val)){if(!r.node.o||null!=r.val){r.updateVal(r.val||(r.fromDefault=!0,[]));let e=Object.keys(r.node.v).filter(e=>!isNaN(+e));if(0<r.val.length||1<e.length){r.pI=r.nI;let t=void 0===r.node.v[0]?v():r.node.v[0]=s(r.node.v[0],1+r.dI),n=1;if(1<e.length)for(;n<e.length;n++){let e=r.node.v[n]=s(r.node.v[n],1+r.dI);r.nodes[r.nI]=e,r.vals[r.nI]=r.val[n-1],r.parents[r.nI]=r.val,r.keys[r.nI]=""+(n-1),r.nI++}for(let e=n-1;e<r.val.length;e++)r.nodes[r.nI]=t,r.vals[r.nI]=r.val[e],r.parents[r.nI]=r.val,r.keys[r.nI]=""+e,r.nI++;r.dI++,r.nodes[r.nI++]=r.sI,r.nextSibling=!1}}}else r.err.push(T("type",r,1040));else if("any"===r.type||"custom"===r.type||"list"===r.type||void 0===r.val||r.type===r.valType||"instance"===r.type&&r.node.u.i&&r.val instanceof r.node.u.i||"null"===r.type&&null===r.val)if(void 0===r.val){let e=r.path[r.dI];!r.node.r||"undefined"===r.type&&r.parent.hasOwnProperty(e)?("custom"!==r.type&&void 0!==r.node.v&&!r.node.o||"undefined"===r.type)&&(r.updateVal(r.node.v),r.fromDefault=!0):r.err.push(T("required",r,1060))}else"string"!==r.type||""!==r.val||r.node.u.empty||r.err.push(T("required",r,1080));else r.err.push(T("type",r,1050));if(0<r.node.a.length)for(let t=0;t<r.node.a.length;t++){let n=f(r.node.a[t],r);void 0!==n.done&&(e=n.done)}r.match||!r.parent||e||r.ignoreVal||r.node.o||(r.parent[r.key]=r.val),r.nextSibling&&(r.pI=r.sI)}if(0<r.err.length)if(Array.isArray(r.ctx.err))r.ctx.err.push(...r.err);else if(!r.match&&!1!==r.ctx.err)throw new l("shape",r.err,r.ctx);return r.match?0===r.err.length:r.root}function c(e,t){return p(e,t,!1)}c.valid=function(e,t){let n=t||{};return p(e,n,!1),null==n.err||0===n.err.length},c.match=(e,t)=>p(e,t=t||{},!0),c.spec=()=>(c(void 0,{err:!1}),JSON.parse(B(a,(e,t)=>n===t||t,!0)));let d="";return c.toString=()=>(d=V(""===d?B(a&&a.$&&(n===a.$.gubu$||!0===a.$.gubu$)?a.v:a):d),`[Gubu ${u.name} ${d}]`),e.inspect&&e.inspect.custom&&(c[e.inspect.custom]=c.toString),c.gubu=r,c}function f(e,t){let n,r={},o=!1;try{o=e(t.val,r,t)}catch(i){n=i}let l=Array.isArray(r.err)?0<r.err.length:null!=r.err;if(!o||l){if(void 0===t.val&&(t.node.o||!t.node.r)&&!0!==r.done)return delete r.err,r;let o=r.why||"custom",l=p(t);if("string"==typeof r.err)t.err.push(D(t,r.err));else if("object"==typeof r.err)t.err.push(...[r.err].flat().map(e=>(e.p=null==e.p?l:e.p,e.m=null==e.m?2010:e.m,e)));else{let r=e.name;null!=r&&""!=r||(r=V(e.toString().replace(/[ \t\r\n]+/g," "))),t.err.push(T(o,t,1045,void 0,{thrown:n},r))}r.done=null==r.done||r.done}return r.hasOwnProperty("uval")?t.updateVal(r.val):void 0===r.val||Number.isNaN(r.val)?"custom"===t.node.t&&(t.ignoreVal=!0):t.updateVal(r.val),void 0!==r.node&&(t.node=r.node),void 0!==r.type&&(t.type=r.type),r}function p(e){return e.path.slice(1,e.dI+1).filter(e=>null!=e).join(".")}const c=function(e){let t=P(this,e);return t.r=!0,void 0===e&&1===arguments.length&&(t.t="undefined",t.v=void 0),t},d=function(e){let t=P(this,e);return t.r=!1,t.o=!0,t},h=function(e){let t=P(this,e);return t.u.empty=!0,t},v=function(e){let t=P(this,e);return t.t="any",void 0!==e&&(t.v=e),t},y=function(e){let t=P(this,e);return t.t="never",t},m=function(...e){let t=P();t.t="list",t.r=!0;let n=e.map(e=>M(e));return t.u.list=e,t.b.push((function(t,r,o){let l=!0;for(let e of n){let n={...o.ctx,err:[]};e(t,n),0<n.err.length&&(l=!1)}return l||(r.why="all",r.err=[D(o,'Value "$VALUE" for path "$PATH" does not satisfy all of: '+e.map(e=>B(e)))]),l})),t},b=function(...e){let t=P();t.t="list",t.r=!0;let n=e.map(e=>M(e));return t.u.list=e,t.b.push((function(t,r,o){let l=!1;for(let e of n){let n={...o.ctx,err:[]};if(l||(l=e.match(t,n)),l)break}return l||(r.why="some",r.err=[D(o,'Value "$VALUE" for path "$PATH" does not satisfy some of: '+e.map(e=>B(e)))]),l})),t},g=function(...e){let t=P();t.t="list",t.r=!0;let n=e.map(e=>M(e));return t.u.list=e,t.b.push((function(t,r,o){let l=0;for(let e of n){let n={...o.ctx,err:[]};e.match(t,n)&&l++}return 1!==l&&(r.why="one",r.err=[D(o,'Value "$VALUE" for path "$PATH" does not satisfy one of: '+e.map(e=>B(e)))]),!0})),t},$=function(...e){let t=P();return t.b.push((function(t,n,r){for(let o=0;o<e.length;o++)if(t===e[o])return!0;return n.err=D(r,`Value "$VALUE" for path "$PATH" must be exactly one of: ${r.node.s}.`),n.done=!0,!1})),t.s=e.map(e=>B(e)).join(","),t},I=function(e,t){let n=P(this,t);return n.b.push(e),n},A=function(e,t){let n=P(this,t);return n.a.push(e),n},x=function(e){let t=P(this,e);return t.b.push((function(e,n,r){if(null!=e&&"object"==typeof e&&!Array.isArray(e)){let o=Object.keys(e),l=t.v;n.err=[];for(let e of o)void 0===l[e]&&n.err.push(T("closed",r,3010,"",{k:e}));return 0===n.err.length}return!0})),t},k=function(e,t){let n=P(this,t),r="string"==typeof e?e:("object"==typeof e&&e||{}).name;return null!=r&&""!=r&&n.b.push((function(e,t,n){return(n.ctx.ref=n.ctx.ref||{})[r]=n.node,!0})),n},j=function(e,t){let n=P(this,t),r="object"==typeof e&&e||{},o="string"==typeof e?e:r.name,l=!!r.fill;return null!=o&&""!=o&&n.b.push((function(e,t,n){if(void 0!==e||l){let e=n.ctx.ref=n.ctx.ref||{};if(void 0!==e[o]){let n={...e[o]};n.t=n.t||"never",t.node=n,t.type=n.t}}return!0})),n},w=function(e,t){let n=P(this,t),r="object"==typeof e&&e||{},o="string"==typeof e?e:r.name,l="boolean"==typeof r.keep?r.keep:void 0,i=Array.isArray(r.claim)?r.claim:[];if(null!=o&&""!=o){let e=(e,t,n)=>{if(void 0===e&&0<i.length){n.ctx.Rename=n.ctx.Rename||{},n.ctx.Rename.fromDefault=n.ctx.Rename.fromDefault||{};for(let e of i){let r=n.ctx.Rename.fromDefault[e]||{};if(void 0!==n.parent[e]&&!r.yes){t.val=n.parent[e],n.match||(n.parent[o]=t.val),t.node=r.node;for(let e=0;e<n.err.length;e++)n.err[e].k===r.key&&(n.err.splice(e,1),e--);if(l){let t=n.cI+1;n.nodes.splice(t,0,s(r.dval)),n.vals.splice(t,0,void 0),n.parents.splice(t,0,n.parent),n.keys.splice(t,0,e),n.nI++,n.pI++}else delete n.parent[e];break}}void 0===t.val&&(t.val=n.node.v)}return!0};Object.defineProperty(e,"name",{value:"Rename:"+o}),n.b.push(e);let t=(e,t,n)=>(n.parent[o]=e,n.match||l||n.key===o||Array.isArray(n.parent)&&!1!==l||(delete n.parent[n.key],t.done=!0),n.ctx.Rename=n.ctx.Rename||{},n.ctx.Rename.fromDefault=n.ctx.Rename.fromDefault||{},n.ctx.Rename.fromDefault[o]={yes:n.fromDefault,key:n.key,dval:n.node.v,node:n.node},!0);Object.defineProperty(t,"name",{value:"Rename:"+o}),n.a.push(t)}return n};function O(e){return"number"==typeof e?e:"number"==typeof(null==e?void 0:e.length)?e.length:null!=e&&"object"==typeof e?Object.keys(e).length:NaN}function V(e,t){let n=String(e),r=null==t||isNaN(t)?30:t<0?0:~~t,o=null==e?0:n.length,l=null==e?"":n.substring(0,o);return(l=r<o?l.substring(0,r-3)+"...":l).substring(0,r)}const N=function(e,t){let n=P(this,t);return n.b.push((function(t,n,r){let o=O(t);if(e<=o)return!0;let l="number"==typeof t?"":"length ";return n.err=D(r,`Value "$VALUE" for path "$PATH" must be a minimum ${l}of ${e} (was ${o}).`),!1})),n},S=function(e,t){let n=P(this,t);return n.b.push((function(t,n,r){let o=O(t);if(o<=e)return!0;let l="number"==typeof t?"":"length ";return n.err=D(r,`Value "$VALUE" for path "$PATH" must be a maximum ${l}of ${e} (was ${o}).`),!1})),n},G=function(e,t){let n=P(this,t);return n.b.push((function(t,n,r){let o=O(t);if(e<o)return!0;let l="number"==typeof t?"be":"have length";return n.err=D(r,`Value "$VALUE" for path "$PATH" must ${l} above ${e} (was ${o}).`),!1})),n},R=function(e,t){let n=P(this,t);return n.b.push((function(t,n,r){let o=O(t);if(o<e)return!0;let l="number"==typeof t?"be":"have length";return n.err=D(r,`Value "$VALUE" for path "$PATH" must ${l} below ${e} (was ${o}).`),!1})),n},E=function(e,t){let n=P(null==t?this:e),r=s(null==t?e:t);return n.a.push((function(e,t,n){if(null!=e){let t=Object.keys(n.node.v),o=Object.keys(e).reduce((e,n)=>(t.includes(n)||e.push(n),e),[]);if(0<o.length){let l=n.nI+o.length-1,i=n.nI;0<t.length?(i--,n.nodes[l]=n.nodes[i],n.vals[l]=n.vals[i],n.parents[l]=n.parents[i],n.keys[l]=n.keys[i]):(l++,n.nodes[l]=n.sI,n.pI=i);for(let t of o)n.nodes[i]=s(r,1+n.dI),n.vals[i]=e[t],n.parents[i]=e,n.keys[i]=t,i++;n.nI=l+1,n.nextSibling=!1,n.dI++}}return!0})),n};function P(e,t){let n=s(void 0===e||e.window===e?t:e);return Object.assign(n,{Above:G,After:A,Any:v,Before:I,Below:R,Closed:x,Define:k,Empty:h,Exact:$,Max:S,Min:N,Never:y,Optional:d,Refer:j,Rename:w,Required:c,Value:E})}function D(e,t,n,r){return T(n||"custom",e,4e3,t,r)}function T(e,t,n,r,o,l){let i={k:t.key,n:t.node,v:t.val,p:p(t),w:e,m:n,t:"",u:o||{}},u=V((void 0===t.val?"":B(t.val)).replace(/"/g,""));return i.t=null==r||""===r?`Validation failed for path "${i.p}" with value "${u}" because `+("type"===e?"instance"===t.node.t?`the value is not an instance of ${t.node.u.n} `:"the value is not of type "+t.node.t:"required"===e?"the value is required":"closed"===e?`the property "${null==o?void 0:o.k}" is not allowed`:"never"===e?"no value is allowed":`check "${e+(l?": "+l:"")}" failed`)+(i.u.thrown?" (threw: "+i.u.thrown.message+")":"."):r.replace(/\$VALUE/g,u).replace(/\$PATH/g,i.p),i}function B(e,t,r){try{let o=JSON.stringify(e,(e,o)=>{var l,i;if(t&&(o=t(e,o)),null!=o&&"object"==typeof o&&o.constructor&&"Object"!==o.constructor.name&&"Array"!==o.constructor.name)o="function"==typeof o.toString?o.toString():o.constructor.name;else if("function"==typeof o)o="function"==typeof a[o.name]&&isNaN(+e)?void 0:null!=o.name&&""!==o.name?o.name:V(o.toString().replace(/[ \t\r\n]+/g," "));else if("bigint"==typeof o)o=String(o.toString());else{if(Number.isNaN(o))return"NaN";!0===r||!0!==(null===(l=null==o?void 0:o.$)||void 0===l?void 0:l.gubu$)&&n!==(null===(i=null==o?void 0:o.$)||void 0===i?void 0:i.gubu$)||(o=null==o.s||""===o.s?o.t:o.s)}return o});return String(o)}catch(o){return JSON.stringify(String(e))}}function L(e){return null==e||"object"!=typeof e?e:JSON.parse(JSON.stringify(e))}const q=e=>s({...e,$:{gubu$:!0}});if("undefined"!=typeof window){let e=[{b:G,n:"Above"},{b:A,n:"After"},{b:m,n:"All"},{b:v,n:"Any"},{b:I,n:"Before"},{b:R,n:"Below"},{b:x,n:"Closed"},{b:k,n:"Define"},{b:h,n:"Empty"},{b:$,n:"Exact"},{b:S,n:"Max"},{b:N,n:"Min"},{b:y,n:"Never"},{b:g,n:"One"},{b:d,n:"Optional"},{b:j,n:"Refer"},{b:w,n:"Rename"},{b:c,n:"Required"},{b:b,n:"Some"},{b:E,n:"Value"}];for(let t of e)Object.defineProperty(t.b,"name",{value:t.n})}Object.assign(a,{Above:G,After:A,All:m,Any:v,Before:I,Below:R,Closed:x,Define:k,Empty:h,Exact:$,Max:S,Min:N,Never:y,One:g,Optional:d,Refer:j,Rename:w,Required:c,Some:b,Value:E,GAbove:G,GAfter:A,GAll:m,GAny:v,GBefore:I,GBelow:R,GClosed:x,GDefine:k,GEmpty:h,GExact:$,GMax:S,GMin:N,GNever:y,GOne:g,GOptional:d,GRefer:j,GRename:w,GRequired:c,GSome:b,GValue:E,G$:q,buildize:P,makeErr:D,stringify:B,truncate:V,Args:H}),Object.defineProperty(a,"name",{value:"gubu"});const M=a;function H(e,t){function n(e){return"function"==typeof e?q({v:e}):e}let r=void 0,o=Object.keys(e).reduce((t,o,l,i)=>{if(o.startsWith("...")&&l+1===i.length)r={name:o.substring(3),shape:n(e[o])};else{let r=o,i=(o.split(":")[1]||"").split(",").filter(e=>""!==e);0<i.length?o=r.split(":")[0]:i=void 0,t[l+1]=w({name:o,claim:i,keep:!0},n(e[r]))}return t},[y()]);r&&(o[0]=A((e,t,n)=>(n.parent[r.name]=n.parent[r.name]||[],n.parent[r.name].push(e),!0),r.shape),o=A((e,t,n)=>(e&&(e[r.name]=e[r.name]||[]),!0),o));let l=M(o);if(t){let e=function(){let e=Array.prototype.slice.call(arguments),n=l(e);return t.call(this,n)};return null!=t.name&&""!=t.name&&Object.defineProperty(e,"name",{value:t.name+"_args"}),e}return l}t.Gubu=M;const{Gubu:U}=t;return U}));