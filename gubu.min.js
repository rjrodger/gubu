!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Gubu=e()}}((function(){var e={},t={};Object.defineProperty(t,"__esModule",{value:!0}),t.Gubu=void 0;const n=Symbol.for("gubu$"),l={gubu$:n,v$:"6.0.0"},r=Symbol.for("gubu$nil"),i=/^[A-Z]/,o="gubu",s="name",u="nan",a="never",c="number",f="required",p="array",h="function",v="object",d="string",g="boolean",m="undefined",y="any",b="list",x="instance",$="null",I="type",k="closed",j="shape",w="check",O="Object",N="Array",S="Function",V="Value",R="Above",A="All",D="Below",E="Max",C="Min",G="Len",B="One",T="Some",M=" for property ",L='"$PATH"',F='"$VALUE"',P=e=>Object.keys(e),z=(e,t,n)=>Object.defineProperty(e,t,n),q=e=>Array.isArray(e),W=e=>JSON.parse(e),_=(e,t)=>JSON.stringify(e,t);class J{constructor(e,t,n,l){this.match=!1,this.dI=0,this.nI=2,this.cI=-1,this.pI=0,this.sI=-1,this.valType=a,this.isRoot=!1,this.key="",this.type=a,this.stop=!0,this.nextSibling=!0,this.fromDefault=!1,this.ignoreVal=void 0,this.curerr=[],this.err=[],this.parents=[],this.keys=[],this.path=[],this.root=e,this.vals=[e,-1],this.node=t,this.nodes=[t,-1],this.ctx=n||{},this.match=!!l}next(){this.stop=!1,this.fromDefault=!1,this.ignoreVal=void 0,this.isRoot=0===this.pI,this.check=void 0;let e=this.nodes[this.pI];for(;+e;)this.dI--,this.ctx.log&&-1<this.dI&&this.ctx.log("e"+(q(this.parents[this.pI])?"a":"o"),this),this.pI=+e,e=this.nodes[this.pI];e?(this.node=e,this.updateVal(this.vals[this.pI]),this.key=this.keys[this.pI],this.cI=this.pI,this.sI=this.pI+1,this.parent=this.parents[this.pI],this.nextSibling=!0,this.type=this.node.t,this.path[this.dI]=this.key,this.oval=this.val,this.curerr.length=0):this.stop=!0}updateVal(e){this.val=e,this.valType=typeof this.val,c===this.valType&&isNaN(this.val)&&(this.valType=u),this.isRoot&&!this.match&&(this.root=this.val)}}class H extends TypeError{constructor(e,t,n,l){var r;super((t=null==t?"":t+": ")+n.map(e=>e.t).join("\n")),this.gubu=!0,this.name="GubuError",this.code=e,this.prefix=t,this.desc=()=>({name:"GubuError",code:e,err:n,ctx:l}),this.stack=null===(r=this.stack)||void 0===r?void 0:r.replace(/.*\/gubu\/gubu\.[tj]s.*\n/g,""),this.props=n.map(e=>{var t;return{path:e.p,what:e.w,type:null===(t=e.n)||void 0===t?void 0:t.t,value:e.v}})}toJSON(){return Object.assign(Object.assign({},this),{err:this.desc().err,name:this.name,message:this.message})}}const U={String:!0,Number:!0,Boolean:!0,Object:!0,Array:!0,Function:!0,Symbol:!0,BigInt:!0},K={string:"",number:0,boolean:!1,object:{},array:[],symbol:Symbol(""),bigint:BigInt(0),null:null};function Z(e,t,o){var s,a,f,g;if(Q===e)e=void 0;else if(null!=e&&(null===(s=e.$)||void 0===s?void 0:s.gubu$)){if(n===e.$.gubu$)return e.d=null==t?e.d:t,e;if(!0===e.$.gubu$){let l=Object.assign({},e);return l.$=Object.assign(Object.assign({v$:"6.0.0"},l.$),{gubu$:n}),l.v=null!=l.v&&v===typeof l.v?Object.assign({},l.v):l.v,l.t=l.t||typeof l.v,h===l.t&&U[l.v.name]&&(l.t=l.v.name.toLowerCase(),l.v=Me(K[l.t]),l.f=l.v),l.r=!!l.r,l.p=!!l.p,l.d=null==t?null==l.d?-1:l.d:t,l.b=l.b||[],l.a=l.a||[],l.u=l.u||{},l.m=l.m||o||{},l}}let b=null===e?$:typeof e;b=m===b?y:b;let I=e,k=I,j=r,w=!1,N={},V=[],R=[];if(v===b)k=void 0,q(I)?(b=p,1===I.length&&(j=I[0],I=[])):null!=I&&Function!==I.constructor&&Object!==I.constructor&&null!=I.constructor?(b=x,N.n=I.constructor.name,N.i=I.constructor,k=I):0===P(I).length&&(j=oe());else if(h===b)if(U[e.name])b=e.name.toLowerCase(),w=!0,I=Me(K[b]),k=I,O===e.name&&(j=oe());else if(I.gubu===l||!0===(null===(a=I.$)||void 0===a?void 0:a.gubu)){let e=I.node?I.node():I;b=e.t,I=e.v,k=I,w=e.r,N=Object.assign({},e.u),V=[...e.a],R=[...e.b]}else S===I.constructor.name&&i.test(I.name)&&(b=x,w=!0,N.n=null===(g=null===(f=I.prototype)||void 0===f?void 0:f.constructor)||void 0===g?void 0:g.name,N.i=I);else c===b&&isNaN(I)?b=u:d===b&&""===I&&(N.empty=!0);let A=null==I||v!==b&&p!==b?I:Object.assign({},I);return{$:l,t:b,v:A,f:k,n:null!=A&&v===typeof A?P(A).length:0,c:j,r:w,p:!1,d:null==t?-1:t,k:[],e:!0,u:N,a:V,b:R,m:o||{}}}function Q(t,i){const o=null==i?{}:i;o.name=null==o.name?"G"+(""+Math.random()).substring(2,8):""+o.name,o.prefix=null==o.prefix?void 0:o.prefix;let s=o.meta=o.meta||{};s.active=!0===s.active||!1,s.suffix=d==typeof s.suffix?s.suffix:"$$";let u=o.keyexpr=o.keyexpr||{};u.active=!1!==u.active;let c=Z(t,0);function h(e,t,n){let l=new J(e,c,t,n);for(;l.next(),!l.stop;){let t=l.node,n=!1,i=!1;if(0<t.b.length)for(let e=0;e<t.b.length;e++){let r=Y(t.b[e],l);t=l.node,void 0!==r.done&&(n=r.done),i=i||!!r.fatal}if(!n){let n=!0,i=void 0===l.val;if(a===l.type)l.curerr.push(Ge(a,l,1070));else if(v===l.type){let e;if(t.r&&i?(l.ignoreVal=!0,l.curerr.push(Ge(f,l,1010))):i||null!==l.val&&v===l.valType&&!q(l.val)?!t.p&&i&&void 0!==t.f?(l.updateVal(t.f),l.fromDefault=!0,e=l.val,n=!1):t.p&&i||(l.updateVal(l.val||(l.fromDefault=!0,{})),e=l.val):(l.curerr.push(Ge(I,l,1020)),e=q(l.val)?l.val:{}),n&&(e=null==e&&!1===l.ctx.err?{}:e,null!=e)){l.ctx.log&&l.ctx.log("so",l);let n=!1,i=P(t.v),o=l.nI;if(0<i.length){n=!0,l.pI=o;for(let n=0;n<i.length;n++){let r,o=i[n];if(s.active&&o.endsWith(s.suffix)){if(r={short:""},d===typeof t.v[o]?r.short=t.v[o]:r=Object.assign(Object.assign({},r),t.v[o]),delete t.v[o],n++,i.length<=n)break;if(i[n]!==o.substring(0,o.length-s.suffix.length))throw new Error("Invalid meta key: "+o);o=i[n]}let a=o,c=t.v[o];if(u.active){let e=/^\s*("(\\.|[^"\\])*"|[^\s]+):\s*(.*?)\s*$/.exec(o);e&&(a=e[1],c=X({src:e[3],val:c}),delete t.v[o])}let f=Z(c,1+l.dI,r);t.v[a]=f,t.k.includes(a)||t.k.push(a),l.nodes[l.nI]=f,l.vals[l.nI]=e[a],l.parents[l.nI]=e,l.keys[l.nI]=a,l.nI++}}let a=P(e).filter(e=>void 0===t.v[e]);if(0<a.length)if(r===t.c)l.ignoreVal=!0,l.curerr.push(Ge(k,l,1100,void 0,{k:a}));else{n=!0,l.pI=o;for(let n of a){let r=t.c=Z(t.c,1+l.dI);l.nodes[l.nI]=r,l.vals[l.nI]=e[n],l.parents[l.nI]=e,l.keys[l.nI]=n,l.nI++}}n?(l.dI++,l.nodes[l.nI]=l.sI,l.parents[l.nI]=e,l.nextSibling=!1,l.nI++):l.ctx.log&&l.ctx.log("eo",l)}}else if(p===l.type)if(t.r&&i)l.ignoreVal=!0,l.curerr.push(Ge(f,l,1030));else if(i||q(l.val)){if(!t.p&&i&&void 0!==t.f)l.updateVal(t.f),l.fromDefault=!0;else if(!t.p||null!=l.val){l.updateVal(l.val||(l.fromDefault=!0,[]));let n=r!==t.c,i=0<l.val.length,o=P(t.v).filter(e=>!isNaN(+e)),s=0<o.length;if(l.ctx.log&&l.ctx.log("sa",l),i||s){l.pI=l.nI;let e=0;if(s)if(o.length<l.val.length&&!n)l.ignoreVal=!0,l.curerr.push(Ge(k,l,1090,void 0,{k:o.length}));else for(;e<o.length;e++){let n=t.v[e]=Z(t.v[e],1+l.dI);l.nodes[l.nI]=n,l.vals[l.nI]=l.val[e],l.parents[l.nI]=l.val,l.keys[l.nI]=""+e,l.nI++}if(n&&i){let n=t.c=Z(t.c,1+l.dI);for(;e<l.val.length;e++)l.nodes[l.nI]=n,l.vals[l.nI]=l.val[e],l.parents[l.nI]=l.val,l.keys[l.nI]=""+e,l.nI++}l.ignoreVal||(l.dI++,l.nodes[l.nI]=l.sI,l.parents[l.nI]=l.val,l.nextSibling=!1,l.nI++)}else l.ctx.log&&n&&null==e&&l.ctx.log("kv",Object.assign(Object.assign({},l),{key:0,val:t.c})),l.ctx.log&&l.ctx.log("ea",l)}}else l.curerr.push(Ge(I,l,1040));else if(y===l.type||b===l.type||void 0===l.val||l.type===l.valType||x===l.type&&t.u.i&&l.val instanceof t.u.i||$===l.type&&null===l.val)if(void 0===l.val){let e=l.path[l.dI];!t.r||m===l.type&&l.parent.hasOwnProperty(e)?void 0!==t.f&&!t.p||m===l.type?(l.updateVal(t.f),l.fromDefault=!0):y===l.type&&(l.ignoreVal=void 0===l.ignoreVal||l.ignoreVal):(l.ignoreVal=!0,l.curerr.push(Ge(f,l,1060))),l.ctx.log&&l.ctx.log("kv",l)}else d!==l.type||""!==l.val||t.u.empty||l.curerr.push(Ge(f,l,1080)),l.ctx.log&&l.ctx.log("kv",l);else l.curerr.push(Ge(I,l,1050))}if(0<t.a.length)for(let e=0;e<t.a.length;e++){let r=Y(t.a[e],l);t=l.node,void 0!==r.done&&(n=r.done),i=i||!!r.fatal}let o=l.node.p?!1!==l.ignoreVal:!!l.ignoreVal;!l.match&&null!=l.parent&&!n&&!o&&(l.parent[l.key]=l.val),l.nextSibling&&(l.pI=l.sI),(l.node.e||i)&&l.err.push(...l.curerr)}if(0<l.err.length)if(q(l.ctx.err))l.ctx.err.push(...l.err);else if(!l.match&&!1!==l.ctx.err)throw new H(j,o.prefix,l.err,l.ctx);return l.match?0===l.err.length:l.root}function g(e,t){return h(e,t,!1)}g.valid=function(e,t){let n=t||{};return n.err=n.err||[],h(e,n,!1),0===n.err.length},g.match=(e,t)=>h(e,t=t||{},!0),g.error=(e,t)=>{let n=t||{};return n.err=n.err||[],h(e,n,!1),n.err},g.spec=()=>(g(void 0,{err:!1}),W(Te(c,(e,t)=>n===t||t,!1,!0))),g.node=()=>(g.spec(),c);let w="";return g.toString=()=>(w=ne(""===w?Te(c&&c.$&&(n===c.$.gubu$||!0===c.$.gubu$)?c.v:c):w),`[Gubu ${o.name} ${w}]`),e.inspect&&e.inspect.custom&&(g[e.inspect.custom]=g.toString),g.gubu=l,g.spec(),g}function X(e){let t=!1;if(null==e.tokens){t=!0,e.tokens=[];let n=/\s*,?\s*([)(\.]|"(\\.|[^"\\])*"|\/(\\.|[^\/\\])*\/[a-z]?|[^)(,\s]+)\s*/g,l=null;for(;l=n.exec(e.src);)e.tokens.push(l[1])}e.i=e.i||0;let n=e.tokens[e.i],l=Fe[n];if(")"===e.tokens[e.i])return e.i++,e.val;e.i++;let r={Number:Number,String:String,Boolean:Boolean};if(null==l)try{return r[n]||(m===n?void 0:"NaN"===n?NaN:n.match(/^\/.+\/$/)?new RegExp(n.substring(1,n.length-1)):W(n))}catch(s){throw new SyntaxError(`Gubu: unexpected token ${n} in builder expression ${e.src}`)}"("===e.tokens[e.i]&&e.i++;let i=[],o=null;for(;null!=(o=e.tokens[e.i])&&")"!==o;){let t=X(e);i.push(t)}return e.i++,e.val=l.call(e.val,...i),"."===e.tokens[e.i]?(e.i++,X(e)):t&&e.i<e.tokens.length?X(e):e.val}function Y(e,t){var n;let l,r={},i=!1;try{i=!(void 0!==t.val||!(null===(n=e.gubu$)||void 0===n?void 0:n.Check))||(t.check=e,e(t.val,r,t))}catch(s){l=s}let o=q(r.err)?0<r.err.length:null!=r.err;if(!i||o){if(void 0===t.val&&(t.node.p||!t.node.r)&&!0!==r.done)return delete r.err,r;let n=r.why||w,i=ee(t);if(d===typeof r.err)t.curerr.push(Ce(t,r.err));else if(v===typeof r.err)t.curerr.push(...[r.err].flat().filter(e=>null!=e).map(e=>(e.p=null==e.p?i:e.p,e.m=null==e.m?2010:e.m,e)));else{let r=e.name;null!=r&&""!=r||(r=ne(e.toString().replace(/[ \t\r\n]+/g," "))),t.curerr.push(Ge(n,t,1045,void 0,{thrown:l},r))}r.done=null==r.done||r.done}return r.hasOwnProperty("uval")?(t.updateVal(r.uval),t.ignoreVal=!1):void 0===r.val||Number.isNaN(r.val)||(t.updateVal(r.val),t.ignoreVal=!1),void 0!==r.node&&(t.node=r.node),void 0!==r.type&&(t.type=r.type),r}function ee(e){return e.path.slice(1,e.dI+1).filter(e=>null!=e).join(".")}function te(e){return c===typeof e?e:c===typeof(null==e?void 0:e.length)?e.length:null!=e&&v===typeof e?P(e).length:NaN}function ne(e,t){let n=String(e),l=null==t||isNaN(t)?30:t<0?0:~~t,r=null==e?0:n.length,i=null==e?"":n.substring(0,r);return i=l<r?i.substring(0,l-3)+"...":i,i.substring(0,l)}const le=function(e){let t=Ee(this,e);return t.r=!0,t.p=!1,void 0===e&&1===arguments.length&&(t.t=m,t.v=void 0),t},re=function(e){let t=Ee(this,e);return t.c=oe(),t},ie=function(e){let t=Ee(this,e);return t.r=!1,void 0===e&&1===arguments.length&&(t.t=m,t.v=void 0),t},oe=function(e){let t=Ee(this,e);return t.t=y,void 0!==e&&(t.v=e,t.f=e),t},se=function(e,t){let n=Ee(this,t);return n.z=e,n},ue=function(e){let t=Ee(this,e);return t.r=!1,t.p=!0,t},ae=function(e){let t=Ee(this,e);return t.r=!1,t.p=!0,t.e=!1,t.a.push((function(e,t,n){return 0<n.curerr.length&&(t.uval=void 0,t.done=!1),!0})),t},ce=function(e){let t=Ee(this);return t.t=h,t.v=e,t.f=e,t},fe=function(e,t){let n=Ee(this,void 0===t?e:t);return n.r=!1,n.f=e,h===typeof e&&U[e.name]&&(n.t=e.name.toLowerCase(),n.f=Me(K[n.t])),n.p=!1,n},pe=function(e){let t=Ee(this,e);return t.u.empty=!0,t},he=function(e){let t=Ee(this,e);return t.t=a,t},ve=function(e,t){let n=Ee(this),l=c===typeof e;n.t=d,l&&null==t&&(n=Z([]));let r=null;return h===typeof e&&(r=e,n=oe()),n.b.push((function(n,i,o){if(r)i.val=r(o.path,o);else if(l){let n=e;i.val=o.path.slice(o.path.length-1-(0<=n?n:0),o.path.length-1+(0<=n?0:1)),d===typeof t&&(i.val=i.val.join(t))}else null==e&&(i.val=o.path[o.path.length-2]);return!0})),n},de=function(...e){let t=Ee();t.t=b,t.r=!0;let n=e.map(e=>Pe(e));return t.u.list=e,t.b.push((function(t,l,r){let i=!0;for(let e of n){let n=Object.assign(Object.assign({},r.ctx),{err:[]});e(t,n),0<n.err.length&&(i=!1)}return i||(l.why=A,l.err=[Ce(r,V+" "+F+M+L+" does not satisfy all of: "+e.map(e=>Te(e,null,!0)).join(", "))]),i})),t},ge=function(...e){let t=Ee();t.t=b,t.r=!0;let n=e.map(e=>Pe(e));return t.u.list=e,t.b.push((function(t,l,r){let i=!1;for(let e of n){let n=Object.assign(Object.assign({},r.ctx),{err:[]}),o=e.match(t,n);o&&(l.val=e(t,n)),i||(i=o)}return i||(l.why=T,l.err=[Ce(r,V+" "+F+M+L+" does not satisfy any of: "+e.map(e=>Te(e,null,!0)).join(", "))]),i})),t},me=function(...e){let t=Ee();t.t=b,t.r=!0;let n=e.map(e=>Pe(e));return t.u.list=e,t.b.push((function(t,l,r){let i=0;for(let e of n){let n=Object.assign(Object.assign({},r.ctx),{err:[]});if(e.match(t,n)){i++,l.val=e(t,n);break}}return 1!==i&&(l.why=B,l.err=[Ce(r,V+" "+F+M+L+" does not satisfy one of: "+e.map(e=>Te(e,null,!0)).join(", "))]),!0})),t},ye=function(...e){let t=Ee();return t.b.push((function(t,n,l){for(let r=0;r<e.length;r++)if(t===e[r])return!0;return n.err=Ce(l,V+" "+F+M+L+" must be exactly one of: "+l.node.s+"."),n.done=!0,!1})),t.s=e.map(e=>Te(e,null,!0)).join(", "),t},be=function(e,t){let n=Ee(this,t);return n.b.push(e),n},xe=function(e,t){let n=Ee(this,t);return n.a.push(e),n},$e=function(e,t){let n=Ee(this,t);if(h===typeof e){let t=e;t.gubu$=t.gubu$||{},t.gubu$.Check=!0,n.b.push(e),n.s=(null==n.s?"":n.s+";")+Te(e,null,!0),n.r=!0}else if(v===typeof e){if(Object.prototype.toString.call(e).includes("RegExp")){let t=t=>null!=t&&!Number.isNaN(t)&&!!String(t).match(e);z(t,s,{value:String(e)}),z(t,"gubu$",{value:{Check:!0}}),n.b.push(t),n.s=Te(e),n.r=!0}}else d===typeof e&&(n.t=e,n.r=!0);return n},Ie=function(e){let t=Ee(this,e);return p===t.t&&r!==t.c&&0===t.n?(t.v=[t.c],t.c=r):t.c=r,t},ke=function(e,t){let n=Ee(this,t),l=d===typeof e?e:(v===typeof e&&e||{}).name;return null!=l&&""!=l&&n.b.push((function(e,t,n){return(n.ctx.ref=n.ctx.ref||{})[l]=n.node,!0})),n},je=function(e,t){let n=Ee(this,t),l=v===typeof e&&e||{},r=d===typeof e?e:l.name,i=!!l.fill;return null!=r&&""!=r&&n.b.push((function(e,t,n){if(void 0!==e||i){let e=n.ctx.ref=n.ctx.ref||{};if(void 0!==e[r]){let n=Object.assign({},e[r]);n.t=n.t||a,t.node=n,t.type=n.t}}return!0})),n},we=function(e,t){let n=Ee(this,t),l=v===typeof e&&e||{},r=d===typeof e?e:l.name,i=g===typeof l.keep?l.keep:void 0,o=q(l.claim)?l.claim:[];if(null!=r&&""!=r){let e=(e,t,n)=>{if(void 0===e&&0<o.length){n.ctx.Rename=n.ctx.Rename||{},n.ctx.Rename.fromDefault=n.ctx.Rename.fromDefault||{};for(let e of o){let l=n.ctx.Rename.fromDefault[e]||{};if(void 0!==n.parent[e]&&!l.yes){t.val=n.parent[e],n.match||(n.parent[r]=t.val),t.node=l.node;for(let e=0;e<n.err.length;e++)n.err[e].k===l.key&&(n.err.splice(e,1),e--);if(i){let t=n.cI+1;n.nodes.splice(t,0,Z(l.dval)),n.vals.splice(t,0,void 0),n.parents.splice(t,0,n.parent),n.keys.splice(t,0,e),n.nI++,n.pI++}else delete n.parent[e];break}}void 0===t.val&&(t.val=n.node.v)}return!0};z(e,s,{value:"Rename:"+r}),n.b.push(e);let t=(e,t,n)=>(n.parent[r]=e,n.match||i||n.key===r||q(n.parent)&&!1!==i||(delete n.parent[n.key],t.done=!0),n.ctx.Rename=n.ctx.Rename||{},n.ctx.Rename.fromDefault=n.ctx.Rename.fromDefault||{},n.ctx.Rename.fromDefault[r]={yes:n.fromDefault,key:n.key,dval:n.node.v,node:n.node},!0);z(t,s,{value:"Rename:"+r}),n.a.push(t)}return n},Oe=function(e,t){let n=Ee(this,t);return n.b.push((function(t,n,l){let r=te(t);if(e<=r)return!0;l.checkargs={min:1};let i=c===typeof t?"":"length ";return n.err=Ce(l,V+" "+F+M+L+` must be a minimum ${i}of ${e} (was ${r}).`),!1})),n.s=C+"("+e+(null==t?"":","+Te(t))+")",n},Ne=function(e,t){let n=Ee(this,t);return n.b.push((function(t,n,l){let r=te(t);if(r<=e)return!0;let i=c===typeof t?"":"length ";return n.err=Ce(l,V+" "+F+M+L+` must be a maximum ${i}of ${e} (was ${r}).`),!1})),n.s=E+"("+e+(null==t?"":","+Te(t))+")",n},Se=function(e,t){let n=Ee(this,t);return n.b.push((function(t,n,l){let r=te(t);if(e<r)return!0;let i=c===typeof t?"be":"have length";return n.err=Ce(l,V+" "+F+M+L+` must ${i} above ${e} (was ${r}).`),!1})),n.s=R+"("+e+(null==t?"":","+Te(t))+")",n},Ve=function(e,t){let n=Ee(this,t);return n.b.push((function(t,n,l){let r=te(t);if(r<e)return!0;let i=c===typeof t?"be":"have length";return n.err=Ce(l,V+" "+F+M+L+` must ${i} below ${e} (was ${r}).`),!1})),n.s=D+"("+e+(null==t?"":","+Te(t))+")",n},Re=function(e,t){let n=Ee(this,t||oe());return n.b.push((function(t,n,l){let r=te(t);if(e===r)return!0;let i=c===typeof t?"":" in length";return n.err=Ce(l,V+" "+F+M+L+` must be exactly ${e}${i} (was ${r}).`),!1})),n.s=G+"("+e+(null==t?"":","+Te(t))+")",n},Ae=function(e,t){let n=Ee(this,t||{});return n.c=Z(e),n},De=function(e,t){let n=Ee(this,t||[]);return n.t="array",n.c=Z(e),n.m=n.m||{},n.m.rest=!0,n};function Ee(e,t){let n=Z(null==e||e.window===e||e.global===e?t:e);return Object.assign(n,{Above:Se,After:xe,Any:oe,Before:be,Below:Ve,Check:$e,Child:Ae,Closed:Ie,Define:ke,Empty:pe,Exact:ye,Fault:se,Ignore:ae,Len:Re,Max:Ne,Min:Oe,Never:he,Open:re,Refer:je,Rename:we,Required:le,Skip:ue,Rest:De})}function Ce(e,t,n,l){return Ge(n||w,e,4e3,t,l)}function Ge(e,t,n,l,r,i){var o;let s={k:t.key,n:t.node,v:t.val,p:ee(t),w:e,c:(null===(o=t.check)||void 0===o?void 0:o.name)||"none",a:t.checkargs||{},m:n,t:"",u:r||{}},u=ne((void 0===t.val?m:Te(t.val)).replace(/"/g,""));if(null==(l=l||t.node.z)||""===l){let n=u.startsWith("[")?p:u.startsWith("{")?v:null==t.val||c===typeof t.val&&isNaN(t.val)?"value":typeof t.val,l=u.startsWith("[")||q(t.parents[t.pI])?"index":"property",o="is",h=null==r?void 0:r.k;h=q(h)?(l=1<h.length?(o="are","properties"):l,h.join(", ")):h,s.t="Validation failed for "+(0<s.p.length?`${l} "${s.p}" with `:"")+`${n} "${u}" because `+(I===e?x===t.node.t?`the ${n} is not an instance of ${t.node.u.n}`:`the ${n} is not of type ${t.node.t}`:f===e?""===t.val?"an empty string is not allowed":`the ${n} is required`:"closed"===e?`the ${l} "${h}" ${o} not allowed`:a===e?"no value is allowed":`check "${null==i?e:i}" failed`)+(s.u.thrown?" (threw: "+s.u.thrown.message+")":".")}else s.t=l.replace(/\$VALUE/g,u).replace(/\$PATH/g,s.p);return s}function Be(e){return null!=e.s&&""!==e.s?e.s:e.r||void 0===e.v?e.t:e.v}function Te(e,t,l,r){let i;r||!e||!e.$||n!==e.$.gubu$&&!0!==e.$.gubu$||(e=Be(e));try{i=_(e,(e,l)=>{var i,o;if(t&&(l=t(e,l)),null!=l&&v===typeof l&&l.constructor&&O!==l.constructor.name&&N!==l.constructor.name)l=h===typeof l.toString?l.toString():l.constructor.name;else if(h===typeof l)l=h===typeof Q[l.name]&&isNaN(+e)?void 0:null!=l.name&&""!==l.name?l.name:ne(l.toString().replace(/[ \t\r\n]+/g," "));else if("bigint"==typeof l)l=String(l.toString());else{if(Number.isNaN(l))return"NaN";!0===r||!0!==(null===(i=null==l?void 0:l.$)||void 0===i?void 0:i.gubu$)&&n!==(null===(o=null==l?void 0:l.$)||void 0===o?void 0:o.gubu$)||(l=Be(l))}return l}),i=String(i)}catch(o){i=_(String(e))}return!0===l&&(i=i.replace(/^"/,"").replace(/"$/,"")),i}function Me(e){return null==e||v!==typeof e?e:W(_(e))}const Le=e=>Z(Object.assign(Object.assign({},e),{$:{gubu$:!0}})),Fe={Above:Se,After:xe,All:de,Any:oe,Before:be,Below:Ve,Check:$e,Child:Ae,Closed:Ie,Default:fe,Define:ke,Empty:pe,Exact:ye,Fault:se,Func:ce,Ignore:ae,Key:ve,Len:Re,Max:Ne,Min:Oe,Never:he,One:me,Open:re,Optional:ie,Refer:je,Rename:we,Required:le,Skip:ue,Some:ge,Rest:De};if(m!==typeof window)for(let We in Fe)z(Fe[We],s,{value:We});Object.assign(Q,Object.assign(Object.assign(Object.assign({Gubu:Q},Fe),Object.entries(Fe).reduce((e,t)=>(e["G"+t[0]]=t[1],e),{})),{isShape:e=>e&&l===e.gubu,G$:Le,buildize:Ee,makeErr:Ce,stringify:Te,truncate:ne,nodize:Z,expr:X,MakeArgu:ze})),z(Q,s,{value:o});const Pe=Q;t.Gubu=Pe;function ze(e){return function(t,n,l){let r=!1;d===typeof t&&(r=!0,l=n,n=t);const i=Pe(l=l||n,{prefix:e+(n=d===typeof n?" ("+n+")":"")}),o=i.node(),s=o.k;let u=t,a={},c=0,f=0;for(;c<s.length;c++){let e=o.v[s[c]];e.p&&(e=o.v[s[c]]=(t=>xe((function(e,n,l){if(0<l.curerr.length){f++;for(let e=s.length-1;e>t;e--)o.v[s[e]].m.rest?a[s[e]].splice(o.v[s[e]].m.rest_pos+t-e,0,a[s[e-1]]):(l.vals[l.pI+e-t]=l.vals[l.pI+e-t-1],a[s[e]]=a[s[e-1]]);n.uval=void 0,n.done=!1}return!0}),e))(c),e.e=!1),c!==s.length-1||o.v[s[c]].m.rest||(o.v[s[c]]=xe((function(e,t,n){return!(s.length-f<u.length&&(0===n.curerr.length&&(t.err=`Too many arguments for type signature (was ${u.length}, expected ${s.length-f})`),t.fatal=!0,1))}),o.v[s[c]]))}function p(e){for(let t=0;t<s.length;t++){let n=o.v[s[t]];n.m.rest?(a[s[t]]=[...e].slice(t),n.m.rest_pos=a[s[t]].length):a[s[t]]=e[t]}return a}return r?function(e){return u=e,a={},c=0,f=0,i(p(e))}:i(p(t))}}const{Gubu:qe}=t;return qe}));