!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Gubu=e()}}((function(){var e={},t={};Object.defineProperty(t,"__esModule",{value:!0}),t.Gubu=void 0;const n=Symbol.for("gubu$"),r={gubu$:n,v$:"3.0.0"},l=Symbol.for("gubu$nil"),i=/^[A-Z]/,o="",u="name",s="never",a="number",f="required",p="array",c="function",h="object",d="string",v="undefined",y="Object",b="Above",m="After",g="All",$="Any",I="Before",A="Below",k="Check",x="Closed",V="Define",w="Empty",O="Exact",S="Func",G="Max",N="Min",j="Never",R="One",E="Open",P="Optional",D="Refer",T="Rename",C="Required",B="Skip",M="Some",L="Value";class H{constructor(e,t,n,r){this.match=!1,this.dI=0,this.nI=2,this.cI=-1,this.pI=0,this.sI=-1,this.valType=s,this.isRoot=!1,this.key=o,this.type=s,this.stop=!0,this.nextSibling=!0,this.fromDefault=!1,this.ignoreVal=void 0,this.err=[],this.parents=[],this.keys=[],this.path=[],this.root=e,this.vals=[e,-1],this.node=t,this.nodes=[t,-1],this.ctx=n||{},this.match=!!r}next(){this.stop=!1,this.fromDefault=!1,this.ignoreVal=void 0,this.isRoot=0===this.pI;let e=this.nodes[this.pI];for(;+e;)this.pI=+e,e=this.nodes[this.pI],this.dI--;e?(this.node=e,this.updateVal(this.vals[this.pI]),this.key=this.keys[this.pI],this.cI=this.pI,this.sI=this.pI+1,this.parent=this.parents[this.pI],this.nextSibling=!0,this.type=this.node.t,this.path[this.dI]=this.key,this.oval=this.val):this.stop=!0}updateVal(e){this.val=e,this.valType=typeof this.val,a===this.valType&&isNaN(this.val)&&(this.valType="nan"),this.isRoot&&!this.match&&(this.root=this.val)}}class U extends TypeError{constructor(e,t,n){super(t.map(e=>e.t).join("\n")),this.gubu=!0,this.name="GubuError",this.code=e,this.desc=()=>({name:"GubuError",code:e,err:t,ctx:n})}toJSON(){return{...this,err:this.desc().err,name:this.name,message:this.message}}}const q={String:!0,Number:!0,Boolean:!0,Object:!0,Array:!0,Function:!0,Symbol:!0,BigInt:!0},F={string:o,number:0,boolean:!1,object:{},array:[],symbol:Symbol(o),bigint:BigInt(0),null:null};function J(e,t){var u,s,f,b;if(W===e)e=void 0;else if(null!=e&&(null===(u=e.$)||void 0===u?void 0:u.gubu$)){if(n===e.$.gubu$)return e.d=null==t?e.d:t,e;if(!0===e.$.gubu$){let r={...e};return r.$={v$:"3.0.0",...r.$,gubu$:n},r.v=null!=r.v&&h===typeof r.v?{...r.v}:r.v,r.t=r.t||typeof r.v,c===r.t&&q[r.v.name]&&(r.t=r.v.name.toLowerCase(),r.v=we(F[r.t])),r.r=!!r.r,r.p=!!r.p,r.d=null==t?null==r.d?-1:r.d:t,r.b=r.b||[],r.a=r.a||[],r.u=r.u||{},r}}let m=null===e?"null":typeof e;m=v===m?"any":m;let g=e,$=l,I=!1,A={},k=[],x=[];if(h===m)Array.isArray(g)?(m=p,1===g.length&&($=g[0],g=[])):null!=g&&Function!==g.constructor&&Object!==g.constructor&&null!=g.constructor?(m="instance",A.n=g.constructor.name,A.i=g.constructor):0===Object.keys(g).length&&($=ee());else if(c===m)if(q[e.name])m=e.name.toLowerCase(),I=!0,g=we(F[m]),y===e.name&&($=ee());else if(g.gubu===r||!0===(null===(s=g.$)||void 0===s?void 0:s.gubu)){let e=g.node?g.node():g;m=e.t,g=e.v,I=e.r,A={...e.u},k=[...e.a],x=[...e.b]}else"Function"===g.constructor.name&&i.test(g.name)&&(m="instance",I=!0,A.n=null===(b=null===(f=g.prototype)||void 0===f?void 0:f.constructor)||void 0===b?void 0:b.name,A.i=g);else a===m&&isNaN(g)?m="nan":d===m&&o===g&&(A.empty=!0);let V=null==g||h!==m&&p!==m?g:{...g};return{$:r,t:m,v:V,n:null!=V&&h===typeof V?Object.keys(V).length:0,c:$,r:I,p:!1,d:null==t?-1:t,u:A,a:k,b:x}}function W(t,i){const u=null==i?{}:i;u.name=null==u.name?"G"+(o+Math.random()).substring(2,8):o+u.name;let a=J(t,0);function c(e,t,n){let r=new H(e,a,t,n);for(;r.next(),!r.stop;){let e=r.node,t=!1;if(0<e.b.length)for(let l=0;l<e.b.length;l++){let n=z(e.b[l],r);e=r.node,void 0!==n.done&&(t=n.done)}if(!t)if(s===r.type)r.err.push(ke(s,r,1070));else if(h===r.type){let t;if(e.r&&void 0===r.val?(r.ignoreVal=!0,r.err.push(ke(f,r,1010))):void 0===r.val||null!==r.val&&h===r.valType&&!Array.isArray(r.val)?e.p&&null==r.val||(r.updateVal(r.val||(r.fromDefault=!0,{})),t=r.val):(r.err.push(ke("type",r,1020)),t=Array.isArray(r.val)?r.val:{}),null!=(t=null==t&&!1===r.ctx.err?{}:t)){let n=!1,i=Object.keys(e.v),o=r.nI;if(0<i.length){n=!0,r.pI=o;for(let n of i){let l=e.v[n]=J(e.v[n],1+r.dI);r.nodes[r.nI]=l,r.vals[r.nI]=t[n],r.parents[r.nI]=t,r.keys[r.nI]=n,r.nI++}}let u=Object.keys(t).filter(t=>void 0===e.v[t]);if(0<u.length)if(l===e.c)r.ignoreVal=!0,r.err.push(ke("closed",r,1100,void 0,{k:u}));else{n=!0,r.pI=o;for(let n of u){let l=e.c=J(e.c,1+r.dI);r.nodes[r.nI]=l,r.vals[r.nI]=t[n],r.parents[r.nI]=t,r.keys[r.nI]=n,r.nI++}}n&&(r.dI++,r.nodes[r.nI++]=r.sI,r.nextSibling=!1)}}else if(p===r.type)if(e.r&&void 0===r.val)r.ignoreVal=!0,r.err.push(ke(f,r,1030));else if(void 0===r.val||Array.isArray(r.val)){if(!e.p||null!=r.val){r.updateVal(r.val||(r.fromDefault=!0,[]));let t=0<r.val.length,n=l!==e.c,i=Object.keys(e.v).filter(e=>!isNaN(+e)),u=0<i.length;if(t||u){r.pI=r.nI;let l=0;if(u)if(i.length<r.val.length&&!n)r.ignoreVal=!0,r.err.push(ke("closed",r,1090,void 0,{k:i.length}));else for(;l<i.length;l++){let t=e.v[l]=J(e.v[l],1+r.dI);r.nodes[r.nI]=t,r.vals[r.nI]=r.val[l],r.parents[r.nI]=r.val,r.keys[r.nI]=o+l,r.nI++}if(n&&t){let t=e.c=J(e.c,1+r.dI);for(;l<r.val.length;l++)r.nodes[r.nI]=t,r.vals[r.nI]=r.val[l],r.parents[r.nI]=r.val,r.keys[r.nI]=o+l,r.nI++}r.ignoreVal||(r.dI++,r.nodes[r.nI++]=r.sI,r.nextSibling=!1)}}}else r.err.push(ke("type",r,1040));else if("any"===r.type||"list"===r.type||void 0===r.val||r.type===r.valType||"instance"===r.type&&e.u.i&&r.val instanceof e.u.i||"null"===r.type&&null===r.val)if(void 0===r.val){let t=r.path[r.dI];!e.r||v===r.type&&r.parent.hasOwnProperty(t)?void 0!==e.v&&!e.p||v===r.type?(r.updateVal(e.v),r.fromDefault=!0):"any"===r.type&&(r.ignoreVal=void 0===r.ignoreVal||r.ignoreVal):(r.ignoreVal=!0,r.err.push(ke(f,r,1060)))}else d!==r.type||o!==r.val||e.u.empty||r.err.push(ke(f,r,1080));else r.err.push(ke("type",r,1050));if(0<e.a.length)for(let l=0;l<e.a.length;l++){let n=z(e.a[l],r);e=r.node,void 0!==n.done&&(t=n.done)}let n=r.node.p?!1!==r.ignoreVal:!!r.ignoreVal;!r.match&&null!=r.parent&&!t&&!n&&(r.parent[r.key]=r.val),r.nextSibling&&(r.pI=r.sI)}if(0<r.err.length)if(Array.isArray(r.ctx.err))r.ctx.err.push(...r.err);else if(!r.match&&!1!==r.ctx.err)throw new U("shape",r.err,r.ctx);return r.match?0===r.err.length:r.root}function y(e,t){return c(e,t,!1)}y.valid=function(e,t){let n=t||{};return n.err=n.err||[],c(e,n,!1),0===n.err.length},y.match=(e,t)=>c(e,t=t||{},!0),y.error=(e,t)=>{let n=t||{};return n.err=n.err||[],c(e,n,!1),n.err},y.spec=()=>(y(void 0,{err:!1}),JSON.parse(Ve(a,(e,t)=>n===t||t,!1,!0))),y.node=()=>(y.spec(),a);let b=o;return y.toString=()=>(b=ve(o===b?Ve(a&&a.$&&(n===a.$.gubu$||!0===a.$.gubu$)?a.v:a):b),`[Gubu ${u.name} ${b}]`),e.inspect&&e.inspect.custom&&(y[e.inspect.custom]=y.toString),y.gubu=r,y}function z(e,t){var n;let r,l={},i=!1;try{i=!(void 0!==t.val||null===(n=e.gubu$)||void 0===n||!n.Check)||e(t.val,l,t)}catch(s){r=s}let u=Array.isArray(l.err)?0<l.err.length:null!=l.err;if(!i||u){if(void 0===t.val&&(t.node.p||!t.node.r)&&!0!==l.done)return delete l.err,l;let n=l.why||"check",i=_(t);if(d===typeof l.err)t.err.push(Ae(t,l.err));else if(h===typeof l.err)t.err.push(...[l.err].flat().map(e=>(e.p=null==e.p?i:e.p,e.m=null==e.m?2010:e.m,e)));else{let l=e.name;null!=l&&o!=l||(l=ve(e.toString().replace(/[ \t\r\n]+/g," "))),t.err.push(ke(n,t,1045,void 0,{thrown:r},l))}l.done=null==l.done||l.done}return l.hasOwnProperty("uval")?(t.updateVal(l.uval),t.ignoreVal=!1):void 0===l.val||Number.isNaN(l.val)||(t.updateVal(l.val),t.ignoreVal=!1),void 0!==l.node&&(t.node=l.node),void 0!==l.type&&(t.type=l.type),l}function _(e){return e.path.slice(1,e.dI+1).filter(e=>null!=e).join(".")}const Z=function(e){let t=Ie(this,e);return t.r=!0,t.p=!1,void 0===e&&1===arguments.length&&(t.t=v,t.v=void 0),t},K=function(e){let t=Ie(this,e);return t.r=!1,void 0===e&&1===arguments.length&&(t.t=v,t.v=void 0),t},Q=function(e){let t=Ie(this,e);return t.r=!1,t.p=!0,t},X=function(e){let t=Ie(this);return t.t=c,t.v=e,t},Y=function(e){let t=Ie(this,e);return t.u.empty=!0,t},ee=function(e){let t=Ie(this,e);return t.t="any",void 0!==e&&(t.v=e),t},te=function(e){let t=Ie(this,e);return t.t=s,t},ne=function(...e){let t=Ie();t.t="list",t.r=!0;let n=e.map(e=>Se(e));return t.u.list=e,t.b.push((function(t,r,l){let i=!0;for(let e of n){let n={...l.ctx,err:[]};e(t,n),0<n.err.length&&(i=!1)}return i||(r.why="all",r.err=[Ae(l,'Value "$VALUE" for property "$PATH" does not satisfy all of: '+e.map(e=>Ve(e,null,!0)).join(", "))]),i})),t},re=function(...e){let t=Ie();t.t="list",t.r=!0;let n=e.map(e=>Se(e));return t.u.list=e,t.b.push((function(t,r,l){let i=!1;for(let e of n){let n={...l.ctx,err:[]},o=e.match(t,n);o&&(r.val=e(t,n)),i||(i=o)}return i||(r.why="some",r.err=[Ae(l,'Value "$VALUE" for property "$PATH" does not satisfy any of: '+e.map(e=>Ve(e,null,!0)).join(", "))]),i})),t},le=function(...e){let t=Ie();t.t="list",t.r=!0;let n=e.map(e=>Se(e));return t.u.list=e,t.b.push((function(t,r,l){let i=0;for(let e of n){let n={...l.ctx,err:[]};if(e.match(t,n)){i++,r.val=e(t,n);break}}return 1!==i&&(r.why="one",r.err=[Ae(l,'Value "$VALUE" for property "$PATH" does not satisfy one of: '+e.map(e=>Ve(e,null,!0)).join(", "))]),!0})),t},ie=function(...e){let t=Ie();return t.b.push((function(t,n,r){for(let l=0;l<e.length;l++)if(t===e[l])return!0;return n.err=Ae(r,'Value "$VALUE" for property "$PATH" must be exactly one of: '+r.node.s+"."),n.done=!0,!1})),t.s=e.map(e=>Ve(e,null,!0)).join(", "),t},oe=function(e,t){let n=Ie(this,t);return n.b.push(e),n},ue=function(e,t){let n=Ie(this,t);return n.a.push(e),n},se=function(e,t){let n=Ie(this,t);if(c===typeof e){let t=e;t.gubu$=t.gubu$||{},t.gubu$.Check=!0,n.b.push(e),n.s=(null==n.s?o:n.s+";")+Ve(e,null,!0),n.r=!0}else if(h===typeof e){if(Object.prototype.toString.call(e).includes("RegExp")){let t=t=>null!=t&&!Number.isNaN(t)&&!!String(t).match(e);Object.defineProperty(t,u,{value:String(e)}),Object.defineProperty(t,"gubu$",{value:{Check:!0}}),n.b.push(t),n.s=Ve(e),n.r=!0}}else d===typeof e&&(n.t=e,n.r=!0);return n},ae=function(e){let t=Ie(this,e);return t.c=ee(),t},fe=function(e){let t=Ie(this,e);return p===t.t&&l!==t.c&&0===t.n?(t.v=[t.c],t.c=l):t.c=l,t},pe=function(e,t){let n=Ie(this,t),r=d===typeof e?e:(h===typeof e&&e||{}).name;return null!=r&&o!=r&&n.b.push((function(e,t,n){return(n.ctx.ref=n.ctx.ref||{})[r]=n.node,!0})),n},ce=function(e,t){let n=Ie(this,t),r=h===typeof e&&e||{},l=d===typeof e?e:r.name,i=!!r.fill;return null!=l&&o!=l&&n.b.push((function(e,t,n){if(void 0!==e||i){let e=n.ctx.ref=n.ctx.ref||{};if(void 0!==e[l]){let n={...e[l]};n.t=n.t||s,t.node=n,t.type=n.t}}return!0})),n},he=function(e,t){let n=Ie(this,t),r=h===typeof e&&e||{},l=d===typeof e?e:r.name,i="boolean"==typeof r.keep?r.keep:void 0,s=Array.isArray(r.claim)?r.claim:[];if(null!=l&&o!=l){let e=(e,t,n)=>{if(void 0===e&&0<s.length){n.ctx.Rename=n.ctx.Rename||{},n.ctx.Rename.fromDefault=n.ctx.Rename.fromDefault||{};for(let e of s){let r=n.ctx.Rename.fromDefault[e]||{};if(void 0!==n.parent[e]&&!r.yes){t.val=n.parent[e],n.match||(n.parent[l]=t.val),t.node=r.node;for(let e=0;e<n.err.length;e++)n.err[e].k===r.key&&(n.err.splice(e,1),e--);if(i){let t=n.cI+1;n.nodes.splice(t,0,J(r.dval)),n.vals.splice(t,0,void 0),n.parents.splice(t,0,n.parent),n.keys.splice(t,0,e),n.nI++,n.pI++}else delete n.parent[e];break}}void 0===t.val&&(t.val=n.node.v)}return!0};Object.defineProperty(e,u,{value:"Rename:"+l}),n.b.push(e);let t=(e,t,n)=>(n.parent[l]=e,n.match||i||n.key===l||Array.isArray(n.parent)&&!1!==i||(delete n.parent[n.key],t.done=!0),n.ctx.Rename=n.ctx.Rename||{},n.ctx.Rename.fromDefault=n.ctx.Rename.fromDefault||{},n.ctx.Rename.fromDefault[l]={yes:n.fromDefault,key:n.key,dval:n.node.v,node:n.node},!0);Object.defineProperty(t,u,{value:"Rename:"+l}),n.a.push(t)}return n};function de(e){return a===typeof e?e:a===typeof(null==e?void 0:e.length)?e.length:null!=e&&h===typeof e?Object.keys(e).length:NaN}function ve(e,t){let n=String(e),r=null==t||isNaN(t)?30:t<0?0:~~t,l=null==e?0:n.length,i=null==e?o:n.substring(0,l);return(i=r<l?i.substring(0,r-3)+"...":i).substring(0,r)}const ye=function(e,t){let n=Ie(this,t);return n.b.push((function(t,n,r){let l=de(t);if(e<=l)return!0;let i=a===typeof t?o:"length ";return n.err=Ae(r,`Value "$VALUE" for property "$PATH" must be a minimum ${i}of ${e} (was ${l}).`),!1})),n.s="Min("+e+(null==t?o:","+Ve(t))+")",n},be=function(e,t){let n=Ie(this,t);return n.b.push((function(t,n,r){let l=de(t);if(l<=e)return!0;let i=a===typeof t?o:"length ";return n.err=Ae(r,`Value "$VALUE" for property "$PATH" must be a maximum ${i}of ${e} (was ${l}).`),!1})),n.s="Max("+e+(null==t?o:","+Ve(t))+")",n},me=function(e,t){let n=Ie(this,t);return n.b.push((function(t,n,r){let l=de(t);if(e<l)return!0;let i=a===typeof t?"be":"have length";return n.err=Ae(r,`Value "$VALUE" for property "$PATH" must ${i} above ${e} (was ${l}).`),!1})),n.s="Above("+e+(null==t?o:","+Ve(t))+")",n},ge=function(e,t){let n=Ie(this,t);return n.b.push((function(t,n,r){let l=de(t);if(l<e)return!0;let i=a===typeof t?"be":"have length";return n.err=Ae(r,`Value "$VALUE" for property "$PATH" must ${i} below ${e} (was ${l}).`),!1})),n.s="Below("+e+(null==t?o:","+Ve(t))+")",n},$e=function(e,t){let n=Ie(null==t?this:t),r=J(e);return n.c=r,n};function Ie(e,t){let n=J(null==e||e.window===e||e.global===e?t:e);return Object.assign(n,{Above:me,After:ue,Any:ee,Before:oe,Below:ge,Check:se,Closed:fe,Open:ae,Define:pe,Empty:Y,Exact:ie,Max:be,Min:ye,Never:te,Refer:ce,Rename:he,Required:Z,Skip:Q,Value:$e})}function Ae(e,t,n,r){return ke(n||"check",e,4e3,t,r)}function ke(e,t,n,r,l,i){let u={k:t.key,n:t.node,v:t.val,p:_(t),w:e,m:n,t:o,u:l||{}},a=ve((void 0===t.val?o:Ve(t.val)).replace(/"/g,o));if(null==r||o===r){let n=a.startsWith("[")?p:a.startsWith("{")?h:"value",r=a.startsWith("[")||Array.isArray(t.parents[t.pI])?"index":"property",c="is",d=null==l?void 0:l.k;d=Array.isArray(d)?(r=1<d.length?(c="are","properties"):r,d.join(", ")):d,u.t="Validation failed for "+(0<u.p.length?`${r} "${u.p}" with `:o)+`${n} "${a}" because `+("type"===e?"instance"===t.node.t?`the ${n} is not an instance of ${t.node.u.n} `:`the ${n} is not of type ${t.node.t}`:f===e?o===t.val?"an empty string is not allowed":`the ${n} is required`:"closed"===e?`the ${r} "${d}" ${c} not allowed`:s===e?"no value is allowed":`check "${null==i?e:i}" failed`)+(u.u.thrown?" (threw: "+u.u.thrown.message+")":".")}else u.t=r.replace(/\$VALUE/g,a).replace(/\$PATH/g,u.p);return u}function xe(e){return null!=e.s&&o!==e.s?e.s:e.r||void 0===e.v?e.t:e.v}function Ve(e,t,r,l){let i;l||!e||!e.$||n!==e.$.gubu$&&!0!==e.$.gubu$||(e=xe(e));try{i=JSON.stringify(e,(e,r)=>{var i,u;if(t&&(r=t(e,r)),null!=r&&h===typeof r&&r.constructor&&y!==r.constructor.name&&"Array"!==r.constructor.name)r=c===typeof r.toString?r.toString():r.constructor.name;else if(c===typeof r)r=c===typeof W[r.name]&&isNaN(+e)?void 0:null!=r.name&&o!==r.name?r.name:ve(r.toString().replace(/[ \t\r\n]+/g," "));else if("bigint"==typeof r)r=String(r.toString());else{if(Number.isNaN(r))return"NaN";!0===l||!0!==(null===(i=null==r?void 0:r.$)||void 0===i?void 0:i.gubu$)&&n!==(null===(u=null==r?void 0:r.$)||void 0===u?void 0:u.gubu$)||(r=xe(r))}return r}),i=String(i)}catch(u){i=JSON.stringify(String(e))}return!0===r&&(i=i.replace(/^"/,o).replace(/"$/,o)),i}function we(e){return null==e||h!==typeof e?e:JSON.parse(JSON.stringify(e))}const Oe=e=>J({...e,$:{gubu$:!0}});if(v!==typeof window){let e=[{b:me,n:b},{b:ue,n:m},{b:ne,n:g},{b:ee,n:$},{b:oe,n:I},{b:ge,n:A},{b:se,n:k},{b:fe,n:x},{b:pe,n:V},{b:Y,n:w},{b:ie,n:O},{b:X,n:S},{b:be,n:G},{b:ye,n:N},{b:te,n:j},{b:le,n:R},{b:ae,n:E},{b:K,n:P},{b:ce,n:D},{b:he,n:T},{b:Z,n:C},{b:Q,n:B},{b:re,n:M},{b:$e,n:L}];for(let t of e)Object.defineProperty(t.b,u,{value:t.n})}Object.assign(W,{Gubu:W,Above:me,After:ue,All:ne,Any:ee,Before:oe,Below:ge,Check:se,Closed:fe,Define:pe,Empty:Y,Exact:ie,Func:X,Max:be,Min:ye,Never:te,One:le,Open:ae,Optional:K,Refer:ce,Rename:he,Required:Z,Skip:Q,Some:re,Value:$e,GAbove:me,GAfter:ue,GAll:ne,GAny:ee,GBefore:oe,GBelow:ge,GCheck:se,GClosed:fe,GDefine:pe,GEmpty:Y,GExact:ie,GFunc:X,GMax:be,GMin:ye,GNever:te,GOne:le,GOpen:ae,GOptional:K,GRefer:ce,GRename:he,GRequired:Z,GSkip:Q,GSome:re,GValue:$e,G$:Oe,buildize:Ie,makeErr:Ae,stringify:Ve,truncate:ve,nodize:J}),Object.defineProperty(W,u,{value:"gubu"});const Se=W;t.Gubu=Se;const{Gubu:Ge}=t;return Ge}));