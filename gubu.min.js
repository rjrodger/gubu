!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Gubu=e()}}((function(){var e={},t={};Object.defineProperty(t,"__esModule",{value:!0}),t.Gubu=void 0;const n=Symbol.for("gubu$"),l={gubu$:n,v$:"3.1.0"},r=Symbol.for("gubu$nil"),i=/^[A-Z]/,o="",u="gubu",s="name",a="nan",f="never",p="number",c="required",h="array",d="function",v="object",b="string",y="undefined",m="any",g="list",$="instance",I="null",x="type",k="Object",w="Array",G="Above",S="After",N="All",V="Any",R="Before",A="Below",O="Check",j="Closed",D="Define",E="Empty",C="Exact",B="Func",M="Max",T="Min",L="Never",q="Len",F="One",P="Open",J="Optional",W="Refer",z="Rename",H="Required",U="Skip",_="Some",Z="Value",K=" for property ",Q='"$PATH"',X='"$VALUE"',Y=e=>Object.keys(e),ee=(e,t,n)=>Object.defineProperty(e,t,n),te=e=>Array.isArray(e),ne=e=>JSON.parse(e),le=(e,t)=>JSON.stringify(e,t);class re{constructor(e,t,n,l){this.match=!1,this.dI=0,this.nI=2,this.cI=-1,this.pI=0,this.sI=-1,this.valType=f,this.isRoot=!1,this.key=o,this.type=f,this.stop=!0,this.nextSibling=!0,this.fromDefault=!1,this.ignoreVal=void 0,this.err=[],this.parents=[],this.keys=[],this.path=[],this.root=e,this.vals=[e,-1],this.node=t,this.nodes=[t,-1],this.ctx=n||{},this.match=!!l}next(){this.stop=!1,this.fromDefault=!1,this.ignoreVal=void 0,this.isRoot=0===this.pI;let e=this.nodes[this.pI];for(;+e;)this.pI=+e,e=this.nodes[this.pI],this.dI--;e?(this.node=e,this.updateVal(this.vals[this.pI]),this.key=this.keys[this.pI],this.cI=this.pI,this.sI=this.pI+1,this.parent=this.parents[this.pI],this.nextSibling=!0,this.type=this.node.t,this.path[this.dI]=this.key,this.oval=this.val):this.stop=!0}updateVal(e){this.val=e,this.valType=typeof this.val,p===this.valType&&isNaN(this.val)&&(this.valType=a),this.isRoot&&!this.match&&(this.root=this.val)}}class ie extends TypeError{constructor(e,t,n){super(t.map(e=>e.t).join("\n")),this.gubu=!0,this.name="GubuError",this.code=e,this.desc=()=>({name:"GubuError",code:e,err:t,ctx:n})}toJSON(){return{...this,err:this.desc().err,name:this.name,message:this.message}}}const oe={String:!0,Number:!0,Boolean:!0,Object:!0,Array:!0,Function:!0,Symbol:!0,BigInt:!0},ue={string:o,number:0,boolean:!1,object:{},array:[],symbol:Symbol(o),bigint:BigInt(0),null:null};function se(e,t){var u,s,f,c;if(ae===e)e=void 0;else if(null!=e&&(null===(u=e.$)||void 0===u?void 0:u.gubu$)){if(n===e.$.gubu$)return e.d=null==t?e.d:t,e;if(!0===e.$.gubu$){let l={...e};return l.$={v$:"3.1.0",...l.$,gubu$:n},l.v=null!=l.v&&v===typeof l.v?{...l.v}:l.v,l.t=l.t||typeof l.v,d===l.t&&oe[l.v.name]&&(l.t=l.v.name.toLowerCase(),l.v=We(ue[l.t])),l.r=!!l.r,l.p=!!l.p,l.d=null==t?null==l.d?-1:l.d:t,l.b=l.b||[],l.a=l.a||[],l.u=l.u||{},l}}let g=null===e?I:typeof e;g=y===g?m:g;let x=e,w=r,G=!1,S={},N=[],V=[];if(v===g)te(x)?(g=h,1===x.length&&(w=x[0],x=[])):null!=x&&Function!==x.constructor&&Object!==x.constructor&&null!=x.constructor?(g=$,S.n=x.constructor.name,S.i=x.constructor):0===Y(x).length&&(w=ye());else if(d===g)if(oe[e.name])g=e.name.toLowerCase(),G=!0,x=We(ue[g]),k===e.name&&(w=ye());else if(x.gubu===l||!0===(null===(s=x.$)||void 0===s?void 0:s.gubu)){let e=x.node?x.node():x;g=e.t,x=e.v,G=e.r,S={...e.u},N=[...e.a],V=[...e.b]}else"Function"===x.constructor.name&&i.test(x.name)&&(g=$,G=!0,S.n=null===(c=null===(f=x.prototype)||void 0===f?void 0:f.constructor)||void 0===c?void 0:c.name,S.i=x);else p===g&&isNaN(x)?g=a:b===g&&o===x&&(S.empty=!0);let R=null==x||v!==g&&h!==g?x:{...x};return{$:l,t:g,v:R,n:null!=R&&v===typeof R?Y(R).length:0,c:w,r:G,p:!1,d:null==t?-1:t,u:S,a:N,b:V}}function ae(t,i){const u=null==i?{}:i;u.name=null==u.name?"G"+(o+Math.random()).substring(2,8):o+u.name;let s=se(t,0);function a(e,t,n){let l=new re(e,s,t,n);for(;l.next(),!l.stop;){let e=l.node,t=!1;if(0<e.b.length)for(let r=0;r<e.b.length;r++){let n=fe(e.b[r],l);e=l.node,void 0!==n.done&&(t=n.done)}if(!t)if(f===l.type)l.err.push(Fe(f,l,1070));else if(v===l.type){let t;if(e.r&&void 0===l.val?(l.ignoreVal=!0,l.err.push(Fe(c,l,1010))):void 0===l.val||null!==l.val&&v===l.valType&&!te(l.val)?e.p&&null==l.val||(l.updateVal(l.val||(l.fromDefault=!0,{})),t=l.val):(l.err.push(Fe(x,l,1020)),t=te(l.val)?l.val:{}),null!=(t=null==t&&!1===l.ctx.err?{}:t)){let n=!1,i=Y(e.v),o=l.nI;if(0<i.length){n=!0,l.pI=o;for(let n of i){let r=e.v[n]=se(e.v[n],1+l.dI);l.nodes[l.nI]=r,l.vals[l.nI]=t[n],l.parents[l.nI]=t,l.keys[l.nI]=n,l.nI++}}let u=Y(t).filter(t=>void 0===e.v[t]);if(0<u.length)if(r===e.c)l.ignoreVal=!0,l.err.push(Fe("closed",l,1100,void 0,{k:u}));else{n=!0,l.pI=o;for(let n of u){let r=e.c=se(e.c,1+l.dI);l.nodes[l.nI]=r,l.vals[l.nI]=t[n],l.parents[l.nI]=t,l.keys[l.nI]=n,l.nI++}}n&&(l.dI++,l.nodes[l.nI++]=l.sI,l.nextSibling=!1)}}else if(h===l.type)if(e.r&&void 0===l.val)l.ignoreVal=!0,l.err.push(Fe(c,l,1030));else if(void 0===l.val||te(l.val)){if(!e.p||null!=l.val){l.updateVal(l.val||(l.fromDefault=!0,[]));let t=0<l.val.length,n=r!==e.c,i=Y(e.v).filter(e=>!isNaN(+e)),u=0<i.length;if(t||u){l.pI=l.nI;let r=0;if(u)if(i.length<l.val.length&&!n)l.ignoreVal=!0,l.err.push(Fe("closed",l,1090,void 0,{k:i.length}));else for(;r<i.length;r++){let t=e.v[r]=se(e.v[r],1+l.dI);l.nodes[l.nI]=t,l.vals[l.nI]=l.val[r],l.parents[l.nI]=l.val,l.keys[l.nI]=o+r,l.nI++}if(n&&t){let t=e.c=se(e.c,1+l.dI);for(;r<l.val.length;r++)l.nodes[l.nI]=t,l.vals[l.nI]=l.val[r],l.parents[l.nI]=l.val,l.keys[l.nI]=o+r,l.nI++}l.ignoreVal||(l.dI++,l.nodes[l.nI++]=l.sI,l.nextSibling=!1)}}}else l.err.push(Fe(x,l,1040));else if(m===l.type||g===l.type||void 0===l.val||l.type===l.valType||$===l.type&&e.u.i&&l.val instanceof e.u.i||I===l.type&&null===l.val)if(void 0===l.val){let t=l.path[l.dI];!e.r||y===l.type&&l.parent.hasOwnProperty(t)?void 0!==e.v&&!e.p||y===l.type?(l.updateVal(e.v),l.fromDefault=!0):m===l.type&&(l.ignoreVal=void 0===l.ignoreVal||l.ignoreVal):(l.ignoreVal=!0,l.err.push(Fe(c,l,1060)))}else b!==l.type||o!==l.val||e.u.empty||l.err.push(Fe(c,l,1080));else l.err.push(Fe(x,l,1050));if(0<e.a.length)for(let r=0;r<e.a.length;r++){let n=fe(e.a[r],l);e=l.node,void 0!==n.done&&(t=n.done)}let n=l.node.p?!1!==l.ignoreVal:!!l.ignoreVal;!l.match&&null!=l.parent&&!t&&!n&&(l.parent[l.key]=l.val),l.nextSibling&&(l.pI=l.sI)}if(0<l.err.length)if(te(l.ctx.err))l.ctx.err.push(...l.err);else if(!l.match&&!1!==l.ctx.err)throw new ie("shape",l.err,l.ctx);return l.match?0===l.err.length:l.root}function p(e,t){return a(e,t,!1)}p.valid=function(e,t){let n=t||{};return n.err=n.err||[],a(e,n,!1),0===n.err.length},p.match=(e,t)=>a(e,t=t||{},!0),p.error=(e,t)=>{let n=t||{};return n.err=n.err||[],a(e,n,!1),n.err},p.spec=()=>(p(void 0,{err:!1}),ne(Je(s,(e,t)=>n===t||t,!1,!0))),p.node=()=>(p.spec(),s);let d=o;return p.toString=()=>(d=je(o===d?Je(s&&s.$&&(n===s.$.gubu$||!0===s.$.gubu$)?s.v:s):d),`[Gubu ${u.name} ${d}]`),e.inspect&&e.inspect.custom&&(p[e.inspect.custom]=p.toString),p.gubu=l,p}function fe(e,t){var n;let l,r={},i=!1;try{i=!(void 0!==t.val||null===(n=e.gubu$)||void 0===n||!n.Check)||e(t.val,r,t)}catch(s){l=s}let u=te(r.err)?0<r.err.length:null!=r.err;if(!i||u){if(void 0===t.val&&(t.node.p||!t.node.r)&&!0!==r.done)return delete r.err,r;let n=r.why||"check",i=pe(t);if(b===typeof r.err)t.err.push(qe(t,r.err));else if(v===typeof r.err)t.err.push(...[r.err].flat().map(e=>(e.p=null==e.p?i:e.p,e.m=null==e.m?2010:e.m,e)));else{let r=e.name;null!=r&&o!=r||(r=je(e.toString().replace(/[ \t\r\n]+/g," "))),t.err.push(Fe(n,t,1045,void 0,{thrown:l},r))}r.done=null==r.done||r.done}return r.hasOwnProperty("uval")?(t.updateVal(r.uval),t.ignoreVal=!1):void 0===r.val||Number.isNaN(r.val)||(t.updateVal(r.val),t.ignoreVal=!1),void 0!==r.node&&(t.node=r.node),void 0!==r.type&&(t.type=r.type),r}function pe(e){return e.path.slice(1,e.dI+1).filter(e=>null!=e).join(".")}const ce=function(e){let t=Le(this,e);return t.r=!0,t.p=!1,void 0===e&&1===arguments.length&&(t.t=y,t.v=void 0),t},he=function(e){let t=Le(this,e);return t.r=!1,void 0===e&&1===arguments.length&&(t.t=y,t.v=void 0),t},de=function(e){let t=Le(this,e);return t.r=!1,t.p=!0,t},ve=function(e){let t=Le(this);return t.t=d,t.v=e,t},be=function(e){let t=Le(this,e);return t.u.empty=!0,t},ye=function(e){let t=Le(this,e);return t.t=m,void 0!==e&&(t.v=e),t},me=function(e){let t=Le(this,e);return t.t=f,t},ge=function(...e){let t=Le();t.t=g,t.r=!0;let n=e.map(e=>He(e));return t.u.list=e,t.b.push((function(t,l,r){let i=!0;for(let e of n){let n={...r.ctx,err:[]};e(t,n),0<n.err.length&&(i=!1)}return i||(l.why=N,l.err=[qe(r,Z+" "+X+K+Q+" does not satisfy all of: "+e.map(e=>Je(e,null,!0)).join(", "))]),i})),t},$e=function(...e){let t=Le();t.t=g,t.r=!0;let n=e.map(e=>He(e));return t.u.list=e,t.b.push((function(t,l,r){let i=!1;for(let e of n){let n={...r.ctx,err:[]},o=e.match(t,n);o&&(l.val=e(t,n)),i||(i=o)}return i||(l.why=_,l.err=[qe(r,Z+" "+X+K+Q+" does not satisfy any of: "+e.map(e=>Je(e,null,!0)).join(", "))]),i})),t},Ie=function(...e){let t=Le();t.t=g,t.r=!0;let n=e.map(e=>He(e));return t.u.list=e,t.b.push((function(t,l,r){let i=0;for(let e of n){let n={...r.ctx,err:[]};if(e.match(t,n)){i++,l.val=e(t,n);break}}return 1!==i&&(l.why=F,l.err=[qe(r,Z+" "+X+K+Q+" does not satisfy one of: "+e.map(e=>Je(e,null,!0)).join(", "))]),!0})),t},xe=function(...e){let t=Le();return t.b.push((function(t,n,l){for(let r=0;r<e.length;r++)if(t===e[r])return!0;return n.err=qe(l,Z+" "+X+K+Q+" must be exactly one of: "+l.node.s+"."),n.done=!0,!1})),t.s=e.map(e=>Je(e,null,!0)).join(", "),t},ke=function(e,t){let n=Le(this,t);return n.b.push(e),n},we=function(e,t){let n=Le(this,t);return n.a.push(e),n},Ge=function(e,t){let n=Le(this,t);if(d===typeof e){let t=e;t.gubu$=t.gubu$||{},t.gubu$.Check=!0,n.b.push(e),n.s=(null==n.s?o:n.s+";")+Je(e,null,!0),n.r=!0}else if(v===typeof e){if(Object.prototype.toString.call(e).includes("RegExp")){let t=t=>null!=t&&!Number.isNaN(t)&&!!String(t).match(e);ee(t,s,{value:String(e)}),ee(t,"gubu$",{value:{Check:!0}}),n.b.push(t),n.s=Je(e),n.r=!0}}else b===typeof e&&(n.t=e,n.r=!0);return n},Se=function(e){let t=Le(this,e);return t.c=ye(),t},Ne=function(e){let t=Le(this,e);return h===t.t&&r!==t.c&&0===t.n?(t.v=[t.c],t.c=r):t.c=r,t},Ve=function(e,t){let n=Le(this,t),l=b===typeof e?e:(v===typeof e&&e||{}).name;return null!=l&&o!=l&&n.b.push((function(e,t,n){return(n.ctx.ref=n.ctx.ref||{})[l]=n.node,!0})),n},Re=function(e,t){let n=Le(this,t),l=v===typeof e&&e||{},r=b===typeof e?e:l.name,i=!!l.fill;return null!=r&&o!=r&&n.b.push((function(e,t,n){if(void 0!==e||i){let e=n.ctx.ref=n.ctx.ref||{};if(void 0!==e[r]){let n={...e[r]};n.t=n.t||f,t.node=n,t.type=n.t}}return!0})),n},Ae=function(e,t){let n=Le(this,t),l=v===typeof e&&e||{},r=b===typeof e?e:l.name,i="boolean"==typeof l.keep?l.keep:void 0,u=te(l.claim)?l.claim:[];if(null!=r&&o!=r){let e=(e,t,n)=>{if(void 0===e&&0<u.length){n.ctx.Rename=n.ctx.Rename||{},n.ctx.Rename.fromDefault=n.ctx.Rename.fromDefault||{};for(let e of u){let l=n.ctx.Rename.fromDefault[e]||{};if(void 0!==n.parent[e]&&!l.yes){t.val=n.parent[e],n.match||(n.parent[r]=t.val),t.node=l.node;for(let e=0;e<n.err.length;e++)n.err[e].k===l.key&&(n.err.splice(e,1),e--);if(i){let t=n.cI+1;n.nodes.splice(t,0,se(l.dval)),n.vals.splice(t,0,void 0),n.parents.splice(t,0,n.parent),n.keys.splice(t,0,e),n.nI++,n.pI++}else delete n.parent[e];break}}void 0===t.val&&(t.val=n.node.v)}return!0};ee(e,s,{value:"Rename:"+r}),n.b.push(e);let t=(e,t,n)=>(n.parent[r]=e,n.match||i||n.key===r||te(n.parent)&&!1!==i||(delete n.parent[n.key],t.done=!0),n.ctx.Rename=n.ctx.Rename||{},n.ctx.Rename.fromDefault=n.ctx.Rename.fromDefault||{},n.ctx.Rename.fromDefault[r]={yes:n.fromDefault,key:n.key,dval:n.node.v,node:n.node},!0);ee(t,s,{value:"Rename:"+r}),n.a.push(t)}return n};function Oe(e){return p===typeof e?e:p===typeof(null==e?void 0:e.length)?e.length:null!=e&&v===typeof e?Y(e).length:NaN}function je(e,t){let n=String(e),l=null==t||isNaN(t)?30:t<0?0:~~t,r=null==e?0:n.length,i=null==e?o:n.substring(0,r);return(i=l<r?i.substring(0,l-3)+"...":i).substring(0,l)}const De=function(e,t){let n=Le(this,t);return n.b.push((function(t,n,l){let r=Oe(t);if(e<=r)return!0;let i=p===typeof t?o:"length ";return n.err=qe(l,Z+" "+X+K+Q+` must be a minimum ${i}of ${e} (was ${r}).`),!1})),n.s=T+"("+e+(null==t?o:","+Je(t))+")",n},Ee=function(e,t){let n=Le(this,t);return n.b.push((function(t,n,l){let r=Oe(t);if(r<=e)return!0;let i=p===typeof t?o:"length ";return n.err=qe(l,Z+" "+X+K+Q+` must be a maximum ${i}of ${e} (was ${r}).`),!1})),n.s=M+"("+e+(null==t?o:","+Je(t))+")",n},Ce=function(e,t){let n=Le(this,t);return n.b.push((function(t,n,l){let r=Oe(t);if(e<r)return!0;let i=p===typeof t?"be":"have length";return n.err=qe(l,Z+" "+X+K+Q+` must ${i} above ${e} (was ${r}).`),!1})),n.s=G+"("+e+(null==t?o:","+Je(t))+")",n},Be=function(e,t){let n=Le(this,t);return n.b.push((function(t,n,l){let r=Oe(t);if(r<e)return!0;let i=p===typeof t?"be":"have length";return n.err=qe(l,Z+" "+X+K+Q+` must ${i} below ${e} (was ${r}).`),!1})),n.s=A+"("+e+(null==t?o:","+Je(t))+")",n},Me=function(e,t){let n=Le(this,t||ye());return n.b.push((function(t,n,l){let r=Oe(t);if(e===r)return!0;let i=p===typeof t?o:" in length";return n.err=qe(l,Z+" "+X+K+Q+` must be exactly ${e}${i} (was ${r}).`),!1})),n.s=q+"("+e+(null==t?o:","+Je(t))+")",n},Te=function(e,t){let n=Le(null==t?this:t),l=se(e);return n.c=l,n};function Le(e,t){let n=se(null==e||e.window===e||e.global===e?t:e);return Object.assign(n,{Above:Ce,After:we,Any:ye,Before:ke,Below:Be,Check:Ge,Closed:Ne,Open:Se,Define:Ve,Empty:be,Exact:xe,Max:Ee,Min:De,Never:me,Len:Me,Refer:Re,Rename:Ae,Required:ce,Skip:de,Value:Te})}function qe(e,t,n,l){return Fe(n||"check",e,4e3,t,l)}function Fe(e,t,n,l,r,i){let u={k:t.key,n:t.node,v:t.val,p:pe(t),w:e,m:n,t:o,u:r||{}},s=je((void 0===t.val?o:Je(t.val)).replace(/"/g,o));if(null==l||o===l){let n=s.startsWith("[")?h:s.startsWith("{")?v:"value",l=s.startsWith("[")||te(t.parents[t.pI])?"index":"property",a="is",p=null==r?void 0:r.k;p=te(p)?(l=1<p.length?(a="are","properties"):l,p.join(", ")):p,u.t="Validation failed for "+(0<u.p.length?`${l} "${u.p}" with `:o)+`${n} "${s}" because `+(x===e?$===t.node.t?`the ${n} is not an instance of ${t.node.u.n} `:`the ${n} is not of type ${t.node.t}`:c===e?o===t.val?"an empty string is not allowed":`the ${n} is required`:"closed"===e?`the ${l} "${p}" ${a} not allowed`:f===e?"no value is allowed":`check "${null==i?e:i}" failed`)+(u.u.thrown?" (threw: "+u.u.thrown.message+")":".")}else u.t=l.replace(/\$VALUE/g,s).replace(/\$PATH/g,u.p);return u}function Pe(e){return null!=e.s&&o!==e.s?e.s:e.r||void 0===e.v?e.t:e.v}function Je(e,t,l,r){let i;r||!e||!e.$||n!==e.$.gubu$&&!0!==e.$.gubu$||(e=Pe(e));try{i=le(e,(e,l)=>{var i,u;if(t&&(l=t(e,l)),null!=l&&v===typeof l&&l.constructor&&k!==l.constructor.name&&w!==l.constructor.name)l=d===typeof l.toString?l.toString():l.constructor.name;else if(d===typeof l)l=d===typeof ae[l.name]&&isNaN(+e)?void 0:null!=l.name&&o!==l.name?l.name:je(l.toString().replace(/[ \t\r\n]+/g," "));else if("bigint"==typeof l)l=String(l.toString());else{if(Number.isNaN(l))return"NaN";!0===r||!0!==(null===(i=null==l?void 0:l.$)||void 0===i?void 0:i.gubu$)&&n!==(null===(u=null==l?void 0:l.$)||void 0===u?void 0:u.gubu$)||(l=Pe(l))}return l}),i=String(i)}catch(u){i=le(String(e))}return!0===l&&(i=i.replace(/^"/,o).replace(/"$/,o)),i}function We(e){return null==e||v!==typeof e?e:ne(le(e))}const ze=e=>se({...e,$:{gubu$:!0}});if(y!==typeof window){let e=[{b:Ce,n:G},{b:we,n:S},{b:ge,n:N},{b:ye,n:V},{b:ke,n:R},{b:Be,n:A},{b:Ge,n:O},{b:Ne,n:j},{b:Ve,n:D},{b:be,n:E},{b:xe,n:C},{b:ve,n:B},{b:Ee,n:M},{b:De,n:T},{b:me,n:L},{b:Me,n:q},{b:Ie,n:F},{b:Se,n:P},{b:he,n:J},{b:Re,n:W},{b:Ae,n:z},{b:ce,n:H},{b:de,n:U},{b:$e,n:_},{b:Te,n:Z}];for(let t of e)ee(t.b,s,{value:t.n})}Object.assign(ae,{Gubu:ae,Above:Ce,After:we,All:ge,Any:ye,Before:ke,Below:Be,Check:Ge,Closed:Ne,Define:Ve,Empty:be,Exact:xe,Func:ve,Max:Ee,Min:De,Never:me,Len:Me,One:Ie,Open:Se,Optional:he,Refer:Re,Rename:Ae,Required:ce,Skip:de,Some:$e,Value:Te,GAbove:Ce,GAfter:we,GAll:ge,GAny:ye,GBefore:ke,GBelow:Be,GCheck:Ge,GClosed:Ne,GDefine:Ve,GEmpty:be,GExact:xe,GFunc:ve,GMax:Ee,GMin:De,GNever:me,GLen:Me,GOne:Ie,GOpen:Se,GOptional:he,GRefer:Re,GRename:Ae,GRequired:ce,GSkip:de,GSome:$e,GValue:Te,G$:ze,buildize:Le,makeErr:qe,stringify:Je,truncate:je,nodize:se}),ee(ae,s,{value:u});const He=ae;t.Gubu=He;const{Gubu:Ue}=t;return Ue}));